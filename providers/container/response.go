package container

import (
	"bytes"
	"encoding/base64"
	"encoding/json"
	"encoding/xml"
	"html/template"

	"github.com/kataras/iris/v12"
)

var (
	_Html, _ = base64.StdEncoding.DecodeString("PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InpoLUNOIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPHRpdGxlPldlbGNvbWU8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGJvZHl7bWFyZ2luOjA7cGFkZGluZzowO2hlaWdodDoxMDB2aDt3aWR0aDoxMDB2dztmb250LWZhbWlseTpBdmVuaXIsSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWY7Y29sb3I6IzJjM2U1MDstd2Via2l0LWZvbnQtc21vb3RoaW5nOmFudGlhbGlhc2VkOy1tb3otb3N4LWZvbnQtc21vb3RoaW5nOmdyYXlzY2FsZTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2JhY2tncm91bmQtY29sb3I6I2Y3ZjdmNzt9aDF7Zm9udC1zaXplOjcycHg7bWFyZ2luOjA7cGFkZGluZzowO2NvbG9yOmJ1cmx5d29vZDt0ZXh0LXNoYWRvdzo0cHggNHB4ICM2NjY7fXVsLGxpe2xpc3Qtc3R5bGU6bm9uZTt9dWx7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdzt9bGl7bWFyZ2luOjAgMTVweDt9cHJle3dpZHRoOjkwdnc7fQogICAgPC9zdHlsZT4KICAgIDxzdHlsZT4KICAgICAgICAuaGxqc3tkaXNwbGF5OmJsb2NrO292ZXJmbG93LXg6YXV0bztwYWRkaW5nOjAuNWVtO2NvbG9yOiNmZmZmZmY7YmFja2dyb3VuZDojMWMxYjFiO2JvcmRlci1yYWRpdXM6IDJweDt9LmhsanMtY29tbWVudHtjb2xvcjojOTk5OTk5O30uaGxqcy1rZXl3b3JkLC5obGpzLXNlbGVjdG9yLXRhZywuaGxqcy1tZXRhLWtleXdvcmQsLmhsanMtZG9jdGFnLC5obGpzLXNlY3Rpb24sLmhsanMtc2VsZWN0b3ItY2xhc3MsLmhsanMtbWV0YSwuaGxqcy1zZWxlY3Rvci1wc2V1ZG8sLmhsanMtYXR0cntjb2xvcjojODhhZWNlO30uaGxqcy1hdHRyaWJ1dGV7Y29sb3I6I2M1OWJjMTt9LmhsanMtbmFtZSwuaGxqcy10eXBlLC5obGpzLW51bWJlciwuaGxqcy1zZWxlY3Rvci1pZCwuaGxqcy1xdW90ZSwuaGxqcy10ZW1wbGF0ZS10YWcsLmhsanMtYnVpbHRfaW4sLmhsanMtdGl0bGUsLmhsanMtbGl0ZXJhbHtjb2xvcjojZjA4ZDQ5O30uaGxqcy1zdHJpbmcsLmhsanMtcmVnZXhwLC5obGpzLXN5bWJvbCwuaGxqcy12YXJpYWJsZSwuaGxqcy10ZW1wbGF0ZS12YXJpYWJsZSwuaGxqcy1saW5rLC5obGpzLXNlbGVjdG9yLWF0dHIsLmhsanMtbWV0YS1zdHJpbmd7Y29sb3I6I2I1YmQ2ODt9LmhsanMtYnVsbGV0LC5obGpzLWNvZGV7Y29sb3I6I2NjY2NjYzt9LmhsanMtZGVsZXRpb257Y29sb3I6I2RlNzE3Njt9LmhsanMtYWRkaXRpb257Y29sb3I6Izc2YzQ5MDt9LmhsanMtZW1waGFzaXN7Zm9udC1zdHlsZTppdGFsaWM7fS5obGpzLXN0cm9uZ3tmb250LXdlaWdodDpib2xkO30KICAgIDwvc3R5bGU+CjwvaGVhZD4KCjxib2R5Pgo8aDE+V2VsY29tZSBUbyBSZXNwb25zZSEhITwvaDE+Cjx1bD4KICAgIDxsaT4KICAgICAgICA8c3Ryb25nPumUmeivr+S7o+eggTo8L3N0cm9uZz4gPHNtYWxsPnt7LkNvZGV9fTwvc21hbGw+CiAgICA8L2xpPgogICAgPGxpPjxzdHJvbmc+6ZSZ6K+v5raI5oGvOjwvc3Ryb25nPiA8c21hbGw+e3suTWVzc2FnZX19PC9zbWFsbD4KICAgIDwvbGk+CjwvdWw+CjxwcmU+CiAgICAgICAgPGNvZGUgY2xhc3M9Impzb24iPnt7Lkpzb259fTwvY29kZT4KICAgIDwvcHJlPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICB2YXIgaGxqcz1mdW5jdGlvbigpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBlKHQpe3JldHVybiB0IGluc3RhbmNlb2YgTWFwP3QuY2xlYXI9dC5kZWxldGU9dC5zZXQ9KCk9Pnt0aHJvdyBFcnJvcigibWFwIGlzIHJlYWQtb25seSIpfTp0IGluc3RhbmNlb2YgU2V0JiYodC5hZGQ9dC5jbGVhcj10LmRlbGV0ZT0oKT0+e3Rocm93IEVycm9yKCJzZXQgaXMgcmVhZC1vbmx5Iil9KSxPYmplY3QuZnJlZXplKHQpLE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHQpLmZvckVhY2goKG49Pnt2YXIgcz10W25dOyJvYmplY3QiIT10eXBlb2Ygc3x8T2JqZWN0LmlzRnJvemVuKHMpfHxlKHMpfSkpLHR9CiAgICAgICAgdmFyIHQ9ZSxuPWU7dC5kZWZhdWx0PW47Y2xhc3Mgc3tjb25zdHJ1Y3RvcihlKXt2b2lkIDA9PT1lLmRhdGEmJihlLmRhdGE9e30pLHRoaXMuZGF0YT1lLmRhdGF9CiAgICAgICAgICAgIGlnbm9yZU1hdGNoKCl7dGhpcy5pZ25vcmU9ITB9fQogICAgICAgIGZ1bmN0aW9uIHIoZSl7cmV0dXJuIGUucmVwbGFjZSgvJi9nLCImIikucmVwbGFjZSgvPC9nLCI8IikucmVwbGFjZSgvPi9nLCI+IikucmVwbGFjZSgvIi9nLCJcIiIpLnJlcGxhY2UoLycvZywiJyIpfQogICAgICAgIGZ1bmN0aW9uIGEoZSwuLi50KXtjb25zdCBuPU9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGNvbnN0IHQgaW4gZSluW3RdPWVbdF07cmV0dXJuIHQuZm9yRWFjaCgoZT0+e2Zvcihjb25zdCB0IGluIGUpblt0XT1lW3RdfSkpLG59CiAgICAgICAgY29uc3QgaT1lPT4hIWUua2luZDtjbGFzcyBve2NvbnN0cnVjdG9yKGUsdCl7dGhpcy5idWZmZXI9IiIsdGhpcy5jbGFzc1ByZWZpeD10LmNsYXNzUHJlZml4LGUud2Fsayh0aGlzKX0KICAgICAgICAgICAgYWRkVGV4dChlKXt0aGlzLmJ1ZmZlcis9cihlKX0KICAgICAgICAgICAgb3Blbk5vZGUoZSl7aWYoIWkoZSkpcmV0dXJuO2xldCB0PWUua2luZDtlLnN1Ymxhbmd1YWdlfHwodD1gJHt0aGlzLmNsYXNzUHJlZml4fSR7dH1gKSx0aGlzLnNwYW4odCl9CiAgICAgICAgICAgIGNsb3NlTm9kZShlKXtpKGUpJiYodGhpcy5idWZmZXIrPSI8L3NwYW4+Iil9CiAgICAgICAgICAgIHZhbHVlKCl7cmV0dXJuIHRoaXMuYnVmZmVyfQogICAgICAgICAgICBzcGFuKGUpe3RoaXMuYnVmZmVyKz1gPHNwYW4gY2xhc3M9IiR7ZX0iPmB9fQogICAgICAgIGNsYXNzIGx7Y29uc3RydWN0b3IoKXt0aGlzLnJvb3ROb2RlPXtjaGlsZHJlbjpbXX0sdGhpcy5zdGFjaz1bdGhpcy5yb290Tm9kZV19CiAgICAgICAgICAgIGdldCB0b3AoKXtyZXR1cm4gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aC0xXX0KICAgICAgICAgICAgZ2V0IHJvb3QoKXtyZXR1cm4gdGhpcy5yb290Tm9kZX0KICAgICAgICAgICAgYWRkKGUpe3RoaXMudG9wLmNoaWxkcmVuLnB1c2goZSl9CiAgICAgICAgICAgIG9wZW5Ob2RlKGUpe2NvbnN0IHQ9e2tpbmQ6ZSxjaGlsZHJlbjpbXX07dGhpcy5hZGQodCksdGhpcy5zdGFjay5wdXNoKHQpfQogICAgICAgICAgICBjbG9zZU5vZGUoKXtpZih0aGlzLnN0YWNrLmxlbmd0aD4xKXJldHVybiB0aGlzLnN0YWNrLnBvcCgpfQogICAgICAgICAgICBjbG9zZUFsbE5vZGVzKCl7Zm9yKDt0aGlzLmNsb3NlTm9kZSgpOyk7fQogICAgICAgICAgICB0b0pTT04oKXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5yb290Tm9kZSxudWxsLDQpfQogICAgICAgICAgICB3YWxrKGUpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLl93YWxrKGUsdGhpcy5yb290Tm9kZSl9CiAgICAgICAgICAgIHN0YXRpYyBfd2FsayhlLHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLmFkZFRleHQodCk6dC5jaGlsZHJlbiYmKGUub3Blbk5vZGUodCksdC5jaGlsZHJlbi5mb3JFYWNoKCh0PT50aGlzLl93YWxrKGUsdCkpKSxlLmNsb3NlTm9kZSh0KSksZX0KICAgICAgICAgICAgc3RhdGljIF9jb2xsYXBzZShlKXsic3RyaW5nIiE9dHlwZW9mIGUmJmUuY2hpbGRyZW4mJihlLmNoaWxkcmVuLmV2ZXJ5KChlPT4ic3RyaW5nIj09dHlwZW9mIGUpKT9lLmNoaWxkcmVuPVtlLmNoaWxkcmVuLmpvaW4oIiIpXTplLmNoaWxkcmVuLmZvckVhY2goKGU9PntsLl9jb2xsYXBzZShlKX0pKSl9fQogICAgICAgIGNsYXNzIGMgZXh0ZW5kcyBse2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksdGhpcy5vcHRpb25zPWV9CiAgICAgICAgICAgIGFkZEtleXdvcmQoZSx0KXsiIiE9PWUmJih0aGlzLm9wZW5Ob2RlKHQpLHRoaXMuYWRkVGV4dChlKSx0aGlzLmNsb3NlTm9kZSgpKX0KICAgICAgICAgICAgYWRkVGV4dChlKXsiIiE9PWUmJnRoaXMuYWRkKGUpfQogICAgICAgICAgICBhZGRTdWJsYW5ndWFnZShlLHQpe2NvbnN0IG49ZS5yb290O24ua2luZD10LG4uc3VibGFuZ3VhZ2U9ITAsdGhpcy5hZGQobil9CiAgICAgICAgICAgIHRvSFRNTCgpe3JldHVybiBuZXcgbyh0aGlzLHRoaXMub3B0aW9ucykudmFsdWUoKX0KICAgICAgICAgICAgZmluYWxpemUoKXtyZXR1cm4hMH19CiAgICAgICAgZnVuY3Rpb24gdShlKXtyZXR1cm4gZT8ic3RyaW5nIj09dHlwZW9mIGU/ZTplLnNvdXJjZTpudWxsfQogICAgICAgIGNvbnN0IGc9IlthLXpBLVpdXFx3KiIsZD0iW2EtekEtWl9dXFx3KiIsaD0iXFxiXFxkKyhcXC5cXGQrKT8iLGY9IigtPykoXFxiMFt4WF1bYS1mQS1GMC05XSt8KFxcYlxcZCsoXFwuXFxkKik/fFxcLlxcZCspKFtlRV1bLStdP1xcZCspPykiLHA9IlxcYigwYlswMV0rKSIsbT17YmVnaW46IlxcXFxbXFxzXFxTXSIscmVsZXZhbmNlOjB9LGI9e2NsYXNzTmFtZToic3RyaW5nIixiZWdpbjoiJyIsZW5kOiInIixpbGxlZ2FsOiJcXG4iLGNvbnRhaW5zOlttXX0seD17Y2xhc3NOYW1lOiJzdHJpbmciLGJlZ2luOiciJyxlbmQ6JyInLGlsbGVnYWw6IlxcbiIsY29udGFpbnM6W21dfSxFPXtiZWdpbjovXGIoYXxhbnx0aGV8YXJlfEknbXxpc24ndHxkb24ndHxkb2Vzbid0fHdvbid0fGJ1dHxqdXN0fHNob3VsZHxwcmV0dHl8c2ltcGx5fGVub3VnaHxnb25uYXxnb2luZ3x3dGZ8c298c3VjaHx3aWxsfHlvdXx5b3VyfHRoZXl8bGlrZXxtb3JlKVxiL30sdj0oZSx0LG49e30pPT57Y29uc3Qgcz1hKHtjbGFzc05hbWU6ImNvbW1lbnQiLGJlZ2luOmUsZW5kOnQsY29udGFpbnM6W119LG4pO3JldHVybiBzLmNvbnRhaW5zLnB1c2goRSkscy5jb250YWlucy5wdXNoKHtjbGFzc05hbWU6ImRvY3RhZyIsYmVnaW46Iig/OlRPRE98RklYTUV8Tk9URXxCVUd8T1BUSU1JWkV8SEFDS3xYWFgpOiIscmVsZXZhbmNlOjB9KSxzfSxOPXYoIi8vIiwiJCIpLHc9digiL1xcKiIsIlxcKi8iKSxSPXYoIiMiLCIkIik7dmFyIHk9T2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsSURFTlRfUkU6ZyxVTkRFUlNDT1JFX0lERU5UX1JFOmQsTlVNQkVSX1JFOmgsQ19OVU1CRVJfUkU6ZixCSU5BUllfTlVNQkVSX1JFOnAsUkVfU1RBUlRFUlNfUkU6IiF8IT18IT09fCV8JT18JnwmJnwmPXxcXCp8XFwqPXxcXCt8XFwrPXwsfC18LT18Lz18L3w6fDt8PDx8PDw9fDw9fDx8PT09fD09fD18Pj4+PXw+Pj18Pj18Pj4+fD4+fD58XFw/fFxcW3xcXHt8XFwofFxcXnxcXF49fFxcfHxcXHw9fFxcfFxcfHx+IixTSEVCQU5HOihlPXt9KT0+e2NvbnN0IHQ9L14jIVsgXSpcLy87cmV0dXJuIGUuYmluYXJ5JiYoZS5iZWdpbj0oKC4uLmUpPT5lLm1hcCgoZT0+dShlKSkpLmpvaW4oIiIpKSh0LC8uKlxiLyxlLmJpbmFyeSwvXGIuKi8pKSxhKHtjbGFzc05hbWU6Im1ldGEiLGJlZ2luOnQsZW5kOi8kLyxyZWxldmFuY2U6MCwib246YmVnaW4iOihlLHQpPT57MCE9PWUuaW5kZXgmJnQuaWdub3JlTWF0Y2goKX19LGUpfSxCQUNLU0xBU0hfRVNDQVBFOm0sQVBPU19TVFJJTkdfTU9ERTpiLFFVT1RFX1NUUklOR19NT0RFOngsUEhSQVNBTF9XT1JEU19NT0RFOkUsQ09NTUVOVDp2LENfTElORV9DT01NRU5UX01PREU6TixDX0JMT0NLX0NPTU1FTlRfTU9ERTp3LEhBU0hfQ09NTUVOVF9NT0RFOlIsTlVNQkVSX01PREU6e2NsYXNzTmFtZToibnVtYmVyIixiZWdpbjpoLHJlbGV2YW5jZTowfSxDX05VTUJFUl9NT0RFOntjbGFzc05hbWU6Im51bWJlciIsYmVnaW46ZixyZWxldmFuY2U6MH0sQklOQVJZX05VTUJFUl9NT0RFOntjbGFzc05hbWU6Im51bWJlciIsYmVnaW46cCxyZWxldmFuY2U6MH0sQ1NTX05VTUJFUl9NT0RFOntjbGFzc05hbWU6Im51bWJlciIsYmVnaW46aCsiKCV8ZW18ZXh8Y2h8cmVtfHZ3fHZofHZtaW58dm1heHxjbXxtbXxpbnxwdHxwY3xweHxkZWd8Z3JhZHxyYWR8dHVybnxzfG1zfEh6fGtIenxkcGl8ZHBjbXxkcHB4KT8iLHJlbGV2YW5jZTowfSxSRUdFWFBfTU9ERTp7YmVnaW46Lyg/PVwvW14vXG5dKlwvKS8sY29udGFpbnM6W3tjbGFzc05hbWU6InJlZ2V4cCIsYmVnaW46L1wvLyxlbmQ6L1wvW2dpbXV5XSovLGlsbGVnYWw6L1xuLyxjb250YWluczpbbSx7YmVnaW46L1xbLyxlbmQ6L1xdLyxyZWxldmFuY2U6MCxjb250YWluczpbbV19XX1dfSxUSVRMRV9NT0RFOntjbGFzc05hbWU6InRpdGxlIixiZWdpbjpnLHJlbGV2YW5jZTowfSxVTkRFUlNDT1JFX1RJVExFX01PREU6e2NsYXNzTmFtZToidGl0bGUiLGJlZ2luOmQscmVsZXZhbmNlOjB9LE1FVEhPRF9HVUFSRDp7YmVnaW46IlxcLlxccypbYS16QS1aX11cXHcqIixyZWxldmFuY2U6MH0sRU5EX1NBTUVfQVNfQkVHSU46ZT0+T2JqZWN0LmFzc2lnbihlLHsib246YmVnaW4iOihlLHQpPT57dC5kYXRhLl9iZWdpbk1hdGNoPWVbMV19LCJvbjplbmQiOihlLHQpPT57dC5kYXRhLl9iZWdpbk1hdGNoIT09ZVsxXSYmdC5pZ25vcmVNYXRjaCgpfX0pfSk7ZnVuY3Rpb24gXyhlLHQpeyIuIj09PWUuaW5wdXRbZS5pbmRleC0xXSYmdC5pZ25vcmVNYXRjaCgpfQogICAgICAgIGZ1bmN0aW9uIGsoZSx0KXt0JiZlLmJlZ2luS2V5d29yZHMmJihlLmJlZ2luPSJcXGIoIitlLmJlZ2luS2V5d29yZHMuc3BsaXQoIiAiKS5qb2luKCJ8IikrIikoPyFcXC4pKD89XFxifFxccykiLGUuX19iZWZvcmVCZWdpbj1fLGUua2V5d29yZHM9ZS5rZXl3b3Jkc3x8ZS5iZWdpbktleXdvcmRzLGRlbGV0ZSBlLmJlZ2luS2V5d29yZHMpfQogICAgICAgIGZ1bmN0aW9uIE0oZSx0KXtBcnJheS5pc0FycmF5KGUuaWxsZWdhbCkmJihlLmlsbGVnYWw9KCguLi5lKT0+IigiK2UubWFwKChlPT51KGUpKSkuam9pbigifCIpKyIpIikoLi4uZS5pbGxlZ2FsKSl9CiAgICAgICAgZnVuY3Rpb24gTyhlLHQpe2lmKGUubWF0Y2gpe2lmKGUuYmVnaW58fGUuZW5kKXRocm93IEVycm9yKCJiZWdpbiAmIGVuZCBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1hdGNoIik7ZS5iZWdpbj1lLm1hdGNoLGRlbGV0ZSBlLm1hdGNofX0KICAgICAgICBmdW5jdGlvbiBBKGUsdCl7dm9pZCAwPT09ZS5yZWxldmFuY2UmJihlLnJlbGV2YW5jZT0xKX0KICAgICAgICBjb25zdCBMPVsib2YiLCJhbmQiLCJmb3IiLCJpbiIsIm5vdCIsIm9yIiwiaWYiLCJ0aGVuIiwicGFyZW50IiwibGlzdCIsInZhbHVlIl07ZnVuY3Rpb24gQihlLHQpe3JldHVybiB0P051bWJlcih0KTooZT0+TC5pbmNsdWRlcyhlLnRvTG93ZXJDYXNlKCkpKShlKT8wOjF9CiAgICAgICAgZnVuY3Rpb24gSShlLHtwbHVnaW5zOnR9KXtmdW5jdGlvbiBuKHQsbil7cmV0dXJuIFJlZ0V4cCh1KHQpLCJtIisoZS5jYXNlX2luc2Vuc2l0aXZlPyJpIjoiIikrKG4/ImciOiIiKSl9CiAgICAgICAgICAgIGNsYXNzIHN7Y29uc3RydWN0b3IoKXt0aGlzLm1hdGNoSW5kZXhlcz17fSx0aGlzLnJlZ2V4ZXM9W10sdGhpcy5tYXRjaEF0PTEsdGhpcy5wb3NpdGlvbj0wfQogICAgICAgICAgICAgICAgYWRkUnVsZShlLHQpe3QucG9zaXRpb249dGhpcy5wb3NpdGlvbisrLHRoaXMubWF0Y2hJbmRleGVzW3RoaXMubWF0Y2hBdF09dCx0aGlzLnJlZ2V4ZXMucHVzaChbdCxlXSksdGhpcy5tYXRjaEF0Kz0oZT0+UmVnRXhwKGUudG9TdHJpbmcoKSsifCIpLmV4ZWMoIiIpLmxlbmd0aC0xKShlKSsxfQogICAgICAgICAgICAgICAgY29tcGlsZSgpezA9PT10aGlzLnJlZ2V4ZXMubGVuZ3RoJiYodGhpcy5leGVjPSgpPT5udWxsKTtjb25zdCBlPXRoaXMucmVnZXhlcy5tYXAoKGU9PmVbMV0pKTt0aGlzLm1hdGNoZXJSZT1uKCgoZSx0PSJ8Iik9Pntjb25zdCBuPS9cWyg/OlteXFxcXV18XFwuKSpcXXxcKFw/P3xcXChbMS05XVswLTldKil8XFwuLztsZXQgcz0wLHI9IiI7Zm9yKGxldCBhPTA7YTxlLmxlbmd0aDthKyspe3MrPTE7Y29uc3QgaT1zO2xldCBvPXUoZVthXSk7Zm9yKGE+MCYmKHIrPXQpLHIrPSIoIjtvLmxlbmd0aD4wOyl7Y29uc3QgZT1uLmV4ZWMobyk7aWYobnVsbD09ZSl7cis9bzticmVha30KICAgICAgICAgICAgICAgICAgICByKz1vLnN1YnN0cmluZygwLGUuaW5kZXgpLG89by5zdWJzdHJpbmcoZS5pbmRleCtlWzBdLmxlbmd0aCksIlxcIj09PWVbMF1bMF0mJmVbMV0/cis9IlxcIisoTnVtYmVyKGVbMV0pK2kpOihyKz1lWzBdLCIoIj09PWVbMF0mJnMrKyl9CiAgICAgICAgICAgICAgICAgICAgcis9IikifQogICAgICAgICAgICAgICAgICAgIHJldHVybiByfSkoZSksITApLHRoaXMubGFzdEluZGV4PTB9CiAgICAgICAgICAgICAgICBleGVjKGUpe3RoaXMubWF0Y2hlclJlLmxhc3RJbmRleD10aGlzLmxhc3RJbmRleDtjb25zdCB0PXRoaXMubWF0Y2hlclJlLmV4ZWMoZSk7aWYoIXQpcmV0dXJuIG51bGw7Y29uc3Qgbj10LmZpbmRJbmRleCgoKGUsdCk9PnQ+MCYmdm9pZCAwIT09ZSkpLHM9dGhpcy5tYXRjaEluZGV4ZXNbbl07cmV0dXJuIHQuc3BsaWNlKDAsbiksT2JqZWN0LmFzc2lnbih0LHMpfX0KICAgICAgICAgICAgY2xhc3Mgcntjb25zdHJ1Y3Rvcigpe3RoaXMucnVsZXM9W10sdGhpcy5tdWx0aVJlZ2V4ZXM9W10sdGhpcy5jb3VudD0wLHRoaXMubGFzdEluZGV4PTAsdGhpcy5yZWdleEluZGV4PTB9CiAgICAgICAgICAgICAgICBnZXRNYXRjaGVyKGUpe2lmKHRoaXMubXVsdGlSZWdleGVzW2VdKXJldHVybiB0aGlzLm11bHRpUmVnZXhlc1tlXTtjb25zdCB0PW5ldyBzO3JldHVybiB0aGlzLnJ1bGVzLnNsaWNlKGUpLmZvckVhY2goKChbZSxuXSk9PnQuYWRkUnVsZShlLG4pKSksdC5jb21waWxlKCksdGhpcy5tdWx0aVJlZ2V4ZXNbZV09dCx0fQogICAgICAgICAgICAgICAgcmVzdW1pbmdTY2FuQXRTYW1lUG9zaXRpb24oKXtyZXR1cm4gMCE9PXRoaXMucmVnZXhJbmRleH0KICAgICAgICAgICAgICAgIGNvbnNpZGVyQWxsKCl7dGhpcy5yZWdleEluZGV4PTB9CiAgICAgICAgICAgICAgICBhZGRSdWxlKGUsdCl7dGhpcy5ydWxlcy5wdXNoKFtlLHRdKSwiYmVnaW4iPT09dC50eXBlJiZ0aGlzLmNvdW50Kyt9CiAgICAgICAgICAgICAgICBleGVjKGUpe2NvbnN0IHQ9dGhpcy5nZXRNYXRjaGVyKHRoaXMucmVnZXhJbmRleCk7dC5sYXN0SW5kZXg9dGhpcy5sYXN0SW5kZXg7bGV0IG49dC5leGVjKGUpO2lmKHRoaXMucmVzdW1pbmdTY2FuQXRTYW1lUG9zaXRpb24oKSkKICAgICAgICAgICAgICAgICAgICBpZihuJiZuLmluZGV4PT09dGhpcy5sYXN0SW5kZXgpO2Vsc2V7Y29uc3QgdD10aGlzLmdldE1hdGNoZXIoMCk7dC5sYXN0SW5kZXg9dGhpcy5sYXN0SW5kZXgrMSxuPXQuZXhlYyhlKX0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbiYmKHRoaXMucmVnZXhJbmRleCs9bi5wb3NpdGlvbisxLHRoaXMucmVnZXhJbmRleD09PXRoaXMuY291bnQmJnRoaXMuY29uc2lkZXJBbGwoKSksbn19CiAgICAgICAgICAgIGlmKGUuY29tcGlsZXJFeHRlbnNpb25zfHwoZS5jb21waWxlckV4dGVuc2lvbnM9W10pLGUuY29udGFpbnMmJmUuY29udGFpbnMuaW5jbHVkZXMoInNlbGYiKSl0aHJvdyBFcnJvcigiRVJSOiBjb250YWlucyBgc2VsZmAgaXMgbm90IHN1cHBvcnRlZCBhdCB0aGUgdG9wLWxldmVsIG9mIGEgbGFuZ3VhZ2UuICBTZWUgZG9jdW1lbnRhdGlvbi4iKTtyZXR1cm4gZS5jbGFzc05hbWVBbGlhc2VzPWEoZS5jbGFzc05hbWVBbGlhc2VzfHx7fSksZnVuY3Rpb24gdChzLGkpe2NvbnN0IG89cztpZihzLmNvbXBpbGVkKXJldHVybiBvO1tPXS5mb3JFYWNoKChlPT5lKHMsaSkpKSxlLmNvbXBpbGVyRXh0ZW5zaW9ucy5mb3JFYWNoKChlPT5lKHMsaSkpKSxzLl9fYmVmb3JlQmVnaW49bnVsbCxbayxNLEFdLmZvckVhY2goKGU9PmUocyxpKSkpLHMuY29tcGlsZWQ9ITA7bGV0IGw9bnVsbDtpZigib2JqZWN0Ij09dHlwZW9mIHMua2V5d29yZHMmJihsPXMua2V5d29yZHMuJHBhdHRlcm4sZGVsZXRlIHMua2V5d29yZHMuJHBhdHRlcm4pLHMua2V5d29yZHMmJihzLmtleXdvcmRzPSgoZSx0KT0+e2NvbnN0IG49e307cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP3MoImtleXdvcmQiLGUpOk9iamVjdC5rZXlzKGUpLmZvckVhY2goKHQ9PntzKHQsZVt0XSl9KSksbjtmdW5jdGlvbiBzKGUscyl7dCYmKHM9cy50b0xvd2VyQ2FzZSgpKSxzLnNwbGl0KCIgIikuZm9yRWFjaCgodD0+e2NvbnN0IHM9dC5zcGxpdCgifCIpO25bc1swXV09W2UsQihzWzBdLHNbMV0pXX0pKX19KShzLmtleXdvcmRzLGUuY2FzZV9pbnNlbnNpdGl2ZSkpLHMubGV4ZW1lcyYmbCl0aHJvdyBFcnJvcigiRVJSOiBQcmVmZXIgYGtleXdvcmRzLiRwYXR0ZXJuYCB0byBgbW9kZS5sZXhlbWVzYCwgQk9USCBhcmUgbm90IGFsbG93ZWQuIChzZWUgbW9kZSByZWZlcmVuY2UpICIpO3JldHVybiBsPWx8fHMubGV4ZW1lc3x8L1x3Ky8sby5rZXl3b3JkUGF0dGVyblJlPW4obCwhMCksaSYmKHMuYmVnaW58fChzLmJlZ2luPS9cQnxcYi8pLG8uYmVnaW5SZT1uKHMuYmVnaW4pLHMuZW5kU2FtZUFzQmVnaW4mJihzLmVuZD1zLmJlZ2luKSxzLmVuZHx8cy5lbmRzV2l0aFBhcmVudHx8KHMuZW5kPS9cQnxcYi8pLHMuZW5kJiYoby5lbmRSZT1uKHMuZW5kKSksby50ZXJtaW5hdG9yRW5kPXUocy5lbmQpfHwiIixzLmVuZHNXaXRoUGFyZW50JiZpLnRlcm1pbmF0b3JFbmQmJihvLnRlcm1pbmF0b3JFbmQrPShzLmVuZD8ifCI6IiIpK2kudGVybWluYXRvckVuZCkpLHMuaWxsZWdhbCYmKG8uaWxsZWdhbFJlPW4ocy5pbGxlZ2FsKSkscy5jb250YWluc3x8KHMuY29udGFpbnM9W10pLHMuY29udGFpbnM9W10uY29uY2F0KC4uLnMuY29udGFpbnMubWFwKChlPT4oZT0+KGUudmFyaWFudHMmJiFlLmNhY2hlZFZhcmlhbnRzJiYoZS5jYWNoZWRWYXJpYW50cz1lLnZhcmlhbnRzLm1hcCgodD0+YShlLHt2YXJpYW50czpudWxsfSx0KSkpKSxlLmNhY2hlZFZhcmlhbnRzP2UuY2FjaGVkVmFyaWFudHM6VChlKT9hKGUse3N0YXJ0czplLnN0YXJ0cz9hKGUuc3RhcnRzKTpudWxsfSk6T2JqZWN0LmlzRnJvemVuKGUpP2EoZSk6ZSkpKCJzZWxmIj09PWU/czplKSkpKSxzLmNvbnRhaW5zLmZvckVhY2goKGU9Pnt0KGUsbyl9KSkscy5zdGFydHMmJnQocy5zdGFydHMsaSksby5tYXRjaGVyPShlPT57Y29uc3QgdD1uZXcgcjtyZXR1cm4gZS5jb250YWlucy5mb3JFYWNoKChlPT50LmFkZFJ1bGUoZS5iZWdpbix7cnVsZTplLHR5cGU6ImJlZ2luIn0pKSksZS50ZXJtaW5hdG9yRW5kJiZ0LmFkZFJ1bGUoZS50ZXJtaW5hdG9yRW5kLHt0eXBlOiJlbmQifSksZS5pbGxlZ2FsJiZ0LmFkZFJ1bGUoZS5pbGxlZ2FsLHt0eXBlOiJpbGxlZ2FsIn0pLHR9KShvKSxvfShlKX0KICAgICAgICBmdW5jdGlvbiBUKGUpe3JldHVybiEhZSYmKGUuZW5kc1dpdGhQYXJlbnR8fFQoZS5zdGFydHMpKX0KICAgICAgICBmdW5jdGlvbiBqKGUpe2NvbnN0IHQ9e3Byb3BzOlsibGFuZ3VhZ2UiLCJjb2RlIiwiYXV0b2RldGVjdCJdLGRhdGE6KCk9Pih7ZGV0ZWN0ZWRMYW5ndWFnZToiIix1bmtub3duTGFuZ3VhZ2U6ITF9KSxjb21wdXRlZDp7Y2xhc3NOYW1lKCl7cmV0dXJuIHRoaXMudW5rbm93bkxhbmd1YWdlPyIiOiJobGpzICIrdGhpcy5kZXRlY3RlZExhbmd1YWdlfSxoaWdobGlnaHRlZCgpe2lmKCF0aGlzLmF1dG9EZXRlY3QmJiFlLmdldExhbmd1YWdlKHRoaXMubGFuZ3VhZ2UpKXJldHVybiBjb25zb2xlLndhcm4oYFRoZSBsYW5ndWFnZSAiJHt0aGlzLmxhbmd1YWdlfSIgeW91IHNwZWNpZmllZCBjb3VsZCBub3QgYmUgZm91bmQuYCksdGhpcy51bmtub3duTGFuZ3VhZ2U9ITAscih0aGlzLmNvZGUpO2xldCB0PXt9O3JldHVybiB0aGlzLmF1dG9EZXRlY3Q/KHQ9ZS5oaWdobGlnaHRBdXRvKHRoaXMuY29kZSksdGhpcy5kZXRlY3RlZExhbmd1YWdlPXQubGFuZ3VhZ2UpOih0PWUuaGlnaGxpZ2h0KHRoaXMubGFuZ3VhZ2UsdGhpcy5jb2RlLHRoaXMuaWdub3JlSWxsZWdhbHMpLHRoaXMuZGV0ZWN0ZWRMYW5ndWFnZT10aGlzLmxhbmd1YWdlKSx0LnZhbHVlfSxhdXRvRGV0ZWN0KCl7cmV0dXJuISh0aGlzLmxhbmd1YWdlJiYoZT10aGlzLmF1dG9kZXRlY3QsIWUmJiIiIT09ZSkpO3ZhciBlfSxpZ25vcmVJbGxlZ2FsczooKT0+ITB9LHJlbmRlcihlKXtyZXR1cm4gZSgicHJlIix7fSxbZSgiY29kZSIse2NsYXNzOnRoaXMuY2xhc3NOYW1lLGRvbVByb3BzOntpbm5lckhUTUw6dGhpcy5oaWdobGlnaHRlZH19KV0pfX07cmV0dXJue0NvbXBvbmVudDp0LFZ1ZVBsdWdpbjp7aW5zdGFsbChlKXtlLmNvbXBvbmVudCgiaGlnaGxpZ2h0anMiLHQpfX19fQogICAgICAgIGNvbnN0IFM9eyJhZnRlcjpoaWdobGlnaHRCbG9jayI6KHtibG9jazplLHJlc3VsdDp0LHRleHQ6bn0pPT57Y29uc3Qgcz1EKGUpO2lmKCFzLmxlbmd0aClyZXR1cm47Y29uc3QgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmlubmVySFRNTD10LnZhbHVlLHQudmFsdWU9KChlLHQsbik9PntsZXQgcz0wLGE9IiI7Y29uc3QgaT1bXTtmdW5jdGlvbiBvKCl7cmV0dXJuIGUubGVuZ3RoJiZ0Lmxlbmd0aD9lWzBdLm9mZnNldCE9PXRbMF0ub2Zmc2V0P2VbMF0ub2Zmc2V0PHRbMF0ub2Zmc2V0P2U6dDoic3RhcnQiPT09dFswXS5ldmVudD9lOnQ6ZS5sZW5ndGg/ZTp0fQogICAgICAgICAgICAgICAgZnVuY3Rpb24gbChlKXthKz0iPCIrUChlKStbXS5tYXAuY2FsbChlLmF0dHJpYnV0ZXMsKGZ1bmN0aW9uKGUpe3JldHVybiIgIitlLm5vZGVOYW1lKyc9IicrcihlLnZhbHVlKSsnIid9KSkuam9pbigiIikrIj4ifQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhlKXthKz0iPC8iK1AoZSkrIj4ifQogICAgICAgICAgICAgICAgZnVuY3Rpb24gdShlKXsoInN0YXJ0Ij09PWUuZXZlbnQ/bDpjKShlLm5vZGUpfQogICAgICAgICAgICAgICAgZm9yKDtlLmxlbmd0aHx8dC5sZW5ndGg7KXtsZXQgdD1vKCk7aWYoYSs9cihuLnN1YnN0cmluZyhzLHRbMF0ub2Zmc2V0KSkscz10WzBdLm9mZnNldCx0PT09ZSl7aS5yZXZlcnNlKCkuZm9yRWFjaChjKTtkb3t1KHQuc3BsaWNlKDAsMSlbMF0pLHQ9bygpfXdoaWxlKHQ9PT1lJiZ0Lmxlbmd0aCYmdFswXS5vZmZzZXQ9PT1zKTtpLnJldmVyc2UoKS5mb3JFYWNoKGwpfWVsc2Uic3RhcnQiPT09dFswXS5ldmVudD9pLnB1c2godFswXS5ub2RlKTppLnBvcCgpLHUodC5zcGxpY2UoMCwxKVswXSl9CiAgICAgICAgICAgICAgICByZXR1cm4gYStyKG4uc3Vic3RyKHMpKX0pKHMsRChhKSxuKX19O2Z1bmN0aW9uIFAoZSl7cmV0dXJuIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKX0KICAgICAgICBmdW5jdGlvbiBEKGUpe2NvbnN0IHQ9W107cmV0dXJuIGZ1bmN0aW9uIGUobixzKXtmb3IobGV0IHI9bi5maXJzdENoaWxkO3I7cj1yLm5leHRTaWJsaW5nKTM9PT1yLm5vZGVUeXBlP3MrPXIubm9kZVZhbHVlLmxlbmd0aDoxPT09ci5ub2RlVHlwZSYmKHQucHVzaCh7ZXZlbnQ6InN0YXJ0IixvZmZzZXQ6cyxub2RlOnJ9KSxzPWUocixzKSxQKHIpLm1hdGNoKC9icnxocnxpbWd8aW5wdXQvKXx8dC5wdXNoKHtldmVudDoic3RvcCIsb2Zmc2V0OnMsbm9kZTpyfSkpO3JldHVybiBzfShlLDApLHR9CiAgICAgICAgY29uc3QgQz1lPT57Y29uc29sZS5lcnJvcihlKX0sSD0oZSwuLi50KT0+e2NvbnNvbGUubG9nKCJXQVJOOiAiK2UsLi4udCl9LCQ9KGUsdCk9Pntjb25zb2xlLmxvZyhgRGVwcmVjYXRlZCBhcyBvZiAke2V9LiAke3R9YCl9LFU9cix6PWEsSz1TeW1ib2woIm5vbWF0Y2giKTtyZXR1cm4oZT0+e2NvbnN0IG49T2JqZWN0LmNyZWF0ZShudWxsKSxyPU9iamVjdC5jcmVhdGUobnVsbCksYT1bXTtsZXQgaT0hMDtjb25zdCBvPS8oXig8W14+XSs+fFx0fCkrfFxuKS9nbSxsPSJDb3VsZCBub3QgZmluZCB0aGUgbGFuZ3VhZ2UgJ3t9JywgZGlkIHlvdSBmb3JnZXQgdG8gbG9hZC9pbmNsdWRlIGEgbGFuZ3VhZ2UgbW9kdWxlPyIsdT17ZGlzYWJsZUF1dG9kZXRlY3Q6ITAsbmFtZToiUGxhaW4gdGV4dCIsY29udGFpbnM6W119O2xldCBnPXtub0hpZ2hsaWdodFJlOi9eKG5vLT9oaWdobGlnaHQpJC9pLGxhbmd1YWdlRGV0ZWN0UmU6L1xibGFuZyg/OnVhZ2UpPy0oW1x3LV0rKVxiL2ksY2xhc3NQcmVmaXg6ImhsanMtIix0YWJSZXBsYWNlOm51bGwsdXNlQlI6ITEsbGFuZ3VhZ2VzOm51bGwsX19lbWl0dGVyOmN9O2Z1bmN0aW9uIGQoZSl7cmV0dXJuIGcubm9IaWdobGlnaHRSZS50ZXN0KGUpfQogICAgICAgICAgICBmdW5jdGlvbiBoKGUsdCxuLHMpe2NvbnN0IHI9e2NvZGU6dCxsYW5ndWFnZTplfTtfKCJiZWZvcmU6aGlnaGxpZ2h0IixyKTtjb25zdCBhPXIucmVzdWx0P3IucmVzdWx0OmYoci5sYW5ndWFnZSxyLmNvZGUsbixzKTtyZXR1cm4gYS5jb2RlPXIuY29kZSxfKCJhZnRlcjpoaWdobGlnaHQiLGEpLGF9CiAgICAgICAgICAgIGZ1bmN0aW9uIGYoZSx0LHIsbyl7Y29uc3QgYz10O2Z1bmN0aW9uIHUoZSx0KXtjb25zdCBuPXcuY2FzZV9pbnNlbnNpdGl2ZT90WzBdLnRvTG93ZXJDYXNlKCk6dFswXTtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUua2V5d29yZHMsbikmJmUua2V5d29yZHNbbl19CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkKCl7bnVsbCE9Xy5zdWJMYW5ndWFnZT8oKCk9PntpZigiIj09PU8pcmV0dXJuO2xldCBlPW51bGw7aWYoInN0cmluZyI9PXR5cGVvZiBfLnN1Ykxhbmd1YWdlKXtpZighbltfLnN1Ykxhbmd1YWdlXSlyZXR1cm4gdm9pZCBNLmFkZFRleHQoTyk7ZT1mKF8uc3ViTGFuZ3VhZ2UsTywhMCxrW18uc3ViTGFuZ3VhZ2VdKSxrW18uc3ViTGFuZ3VhZ2VdPWUudG9wfWVsc2UgZT1wKE8sXy5zdWJMYW5ndWFnZS5sZW5ndGg/Xy5zdWJMYW5ndWFnZTpudWxsKTtfLnJlbGV2YW5jZT4wJiYoQSs9ZS5yZWxldmFuY2UpLE0uYWRkU3VibGFuZ3VhZ2UoZS5lbWl0dGVyLGUubGFuZ3VhZ2UpfSkoKTooKCk9PntpZighXy5rZXl3b3JkcylyZXR1cm4gdm9pZCBNLmFkZFRleHQoTyk7bGV0IGU9MDtfLmtleXdvcmRQYXR0ZXJuUmUubGFzdEluZGV4PTA7bGV0IHQ9Xy5rZXl3b3JkUGF0dGVyblJlLmV4ZWMoTyksbj0iIjtmb3IoO3Q7KXtuKz1PLnN1YnN0cmluZyhlLHQuaW5kZXgpO2NvbnN0IHM9dShfLHQpO2lmKHMpe2NvbnN0W2Uscl09cztNLmFkZFRleHQobiksbj0iIixBKz1yO2NvbnN0IGE9dy5jbGFzc05hbWVBbGlhc2VzW2VdfHxlO00uYWRkS2V5d29yZCh0WzBdLGEpfWVsc2Ugbis9dFswXTtlPV8ua2V5d29yZFBhdHRlcm5SZS5sYXN0SW5kZXgsdD1fLmtleXdvcmRQYXR0ZXJuUmUuZXhlYyhPKX0KICAgICAgICAgICAgICAgICAgICBuKz1PLnN1YnN0cihlKSxNLmFkZFRleHQobil9KSgpLE89IiJ9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoKGUpe3JldHVybiBlLmNsYXNzTmFtZSYmTS5vcGVuTm9kZSh3LmNsYXNzTmFtZUFsaWFzZXNbZS5jbGFzc05hbWVdfHxlLmNsYXNzTmFtZSksXz1PYmplY3QuY3JlYXRlKGUse3BhcmVudDp7dmFsdWU6X319KSxffQogICAgICAgICAgICAgICAgZnVuY3Rpb24gbShlLHQsbil7bGV0IHI9KChlLHQpPT57Y29uc3Qgbj1lJiZlLmV4ZWModCk7cmV0dXJuIG4mJjA9PT1uLmluZGV4fSkoZS5lbmRSZSxuKTtpZihyKXtpZihlWyJvbjplbmQiXSl7Y29uc3Qgbj1uZXcgcyhlKTtlWyJvbjplbmQiXSh0LG4pLG4uaWdub3JlJiYocj0hMSl9CiAgICAgICAgICAgICAgICAgICAgaWYocil7Zm9yKDtlLmVuZHNQYXJlbnQmJmUucGFyZW50OyllPWUucGFyZW50O3JldHVybiBlfX0KICAgICAgICAgICAgICAgICAgICBpZihlLmVuZHNXaXRoUGFyZW50KXJldHVybiBtKGUucGFyZW50LHQsbil9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKGUpe3JldHVybiAwPT09Xy5tYXRjaGVyLnJlZ2V4SW5kZXg/KE8rPWVbMF0sMSk6KFQ9ITAsMCl9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB4KGUpe2NvbnN0IHQ9ZVswXSxuPWMuc3Vic3RyKGUuaW5kZXgpLHM9bShfLGUsbik7aWYoIXMpcmV0dXJuIEs7Y29uc3Qgcj1fO3Iuc2tpcD9PKz10OihyLnJldHVybkVuZHx8ci5leGNsdWRlRW5kfHwoTys9dCksZCgpLHIuZXhjbHVkZUVuZCYmKE89dCkpO2Rve18uY2xhc3NOYW1lJiZNLmNsb3NlTm9kZSgpLF8uc2tpcHx8Xy5zdWJMYW5ndWFnZXx8KEErPV8ucmVsZXZhbmNlKSxfPV8ucGFyZW50fXdoaWxlKF8hPT1zLnBhcmVudCk7cmV0dXJuIHMuc3RhcnRzJiYocy5lbmRTYW1lQXNCZWdpbiYmKHMuc3RhcnRzLmVuZFJlPXMuZW5kUmUpLGgocy5zdGFydHMpKSxyLnJldHVybkVuZD8wOnQubGVuZ3RofQogICAgICAgICAgICAgICAgbGV0IEU9e307ZnVuY3Rpb24gdih0LG4pe2NvbnN0IGE9biYmblswXTtpZihPKz10LG51bGw9PWEpcmV0dXJuIGQoKSwwO2lmKCJiZWdpbiI9PT1FLnR5cGUmJiJlbmQiPT09bi50eXBlJiZFLmluZGV4PT09bi5pbmRleCYmIiI9PT1hKXtpZihPKz1jLnNsaWNlKG4uaW5kZXgsbi5pbmRleCsxKSwhaSl7Y29uc3QgdD1FcnJvcigiMCB3aWR0aCBtYXRjaCByZWdleCIpO3Rocm93IHQubGFuZ3VhZ2VOYW1lPWUsdC5iYWRSdWxlPUUucnVsZSx0fQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxfQogICAgICAgICAgICAgICAgICAgIGlmKEU9biwiYmVnaW4iPT09bi50eXBlKXJldHVybiBmdW5jdGlvbihlKXtjb25zdCB0PWVbMF0sbj1lLnJ1bGUscj1uZXcgcyhuKSxhPVtuLl9fYmVmb3JlQmVnaW4sblsib246YmVnaW4iXV07Zm9yKGNvbnN0IG4gb2YgYSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYobiYmKG4oZSxyKSxyLmlnbm9yZSkpcmV0dXJuIGIodCk7cmV0dXJuIG4mJm4uZW5kU2FtZUFzQmVnaW4mJihuLmVuZFJlPVJlZ0V4cCh0LnJlcGxhY2UoL1stL1xcXiQqKz8uKCl8W1xde31dL2csIlxcJCYiKSwibSIpKSxuLnNraXA/Tys9dDoobi5leGNsdWRlQmVnaW4mJihPKz10KSxkKCksbi5yZXR1cm5CZWdpbnx8bi5leGNsdWRlQmVnaW58fChPPXQpKSxoKG4pLG4ucmV0dXJuQmVnaW4/MDp0Lmxlbmd0aH0obik7aWYoImlsbGVnYWwiPT09bi50eXBlJiYhcil7Y29uc3QgZT1FcnJvcignSWxsZWdhbCBsZXhlbWUgIicrYSsnIiBmb3IgbW9kZSAiJysoXy5jbGFzc05hbWV8fCI8dW5uYW1lZD4iKSsnIicpO3Rocm93IGUubW9kZT1fLGV9CiAgICAgICAgICAgICAgICAgICAgaWYoImVuZCI9PT1uLnR5cGUpe2NvbnN0IGU9eChuKTtpZihlIT09SylyZXR1cm4gZX0KICAgICAgICAgICAgICAgICAgICBpZigiaWxsZWdhbCI9PT1uLnR5cGUmJiIiPT09YSlyZXR1cm4gMTtpZihCPjFlNSYmQj4zKm4uaW5kZXgpdGhyb3cgRXJyb3IoInBvdGVudGlhbCBpbmZpbml0ZSBsb29wLCB3YXkgbW9yZSBpdGVyYXRpb25zIHRoYW4gbWF0Y2hlcyIpO3JldHVybiBPKz1hLGEubGVuZ3RofQogICAgICAgICAgICAgICAgY29uc3Qgdz1OKGUpO2lmKCF3KXRocm93IEMobC5yZXBsYWNlKCJ7fSIsZSkpLEVycm9yKCdVbmtub3duIGxhbmd1YWdlOiAiJytlKyciJyk7Y29uc3QgUj1JKHcse3BsdWdpbnM6YX0pO2xldCB5PSIiLF89b3x8Ujtjb25zdCBrPXt9LE09bmV3IGcuX19lbWl0dGVyKGcpOygoKT0+e2NvbnN0IGU9W107Zm9yKGxldCB0PV87dCE9PXc7dD10LnBhcmVudCl0LmNsYXNzTmFtZSYmZS51bnNoaWZ0KHQuY2xhc3NOYW1lKTtlLmZvckVhY2goKGU9Pk0ub3Blbk5vZGUoZSkpKX0pKCk7bGV0IE89IiIsQT0wLEw9MCxCPTAsVD0hMTt0cnl7Zm9yKF8ubWF0Y2hlci5jb25zaWRlckFsbCgpOzspe0IrKyxUP1Q9ITE6Xy5tYXRjaGVyLmNvbnNpZGVyQWxsKCksXy5tYXRjaGVyLmxhc3RJbmRleD1MO2NvbnN0IGU9Xy5tYXRjaGVyLmV4ZWMoYyk7aWYoIWUpYnJlYWs7Y29uc3QgdD12KGMuc3Vic3RyaW5nKEwsZS5pbmRleCksZSk7TD1lLmluZGV4K3R9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYoYy5zdWJzdHIoTCkpLE0uY2xvc2VBbGxOb2RlcygpLE0uZmluYWxpemUoKSx5PU0udG9IVE1MKCkse3JlbGV2YW5jZTpBLHZhbHVlOnksbGFuZ3VhZ2U6ZSxpbGxlZ2FsOiExLGVtaXR0ZXI6TSx0b3A6X319Y2F0Y2godCl7aWYodC5tZXNzYWdlJiZ0Lm1lc3NhZ2UuaW5jbHVkZXMoIklsbGVnYWwiKSlyZXR1cm57aWxsZWdhbDohMCxpbGxlZ2FsQnk6e21zZzp0Lm1lc3NhZ2UsY29udGV4dDpjLnNsaWNlKEwtMTAwLEwrMTAwKSxtb2RlOnQubW9kZX0sc29mYXI6eSxyZWxldmFuY2U6MCx2YWx1ZTpVKGMpLGVtaXR0ZXI6TX07aWYoaSlyZXR1cm57aWxsZWdhbDohMSxyZWxldmFuY2U6MCx2YWx1ZTpVKGMpLGVtaXR0ZXI6TSxsYW5ndWFnZTplLHRvcDpfLGVycm9yUmFpc2VkOnR9O3Rocm93IHR9fQogICAgICAgICAgICBmdW5jdGlvbiBwKGUsdCl7dD10fHxnLmxhbmd1YWdlc3x8T2JqZWN0LmtleXMobik7Y29uc3Qgcz0oZT0+e2NvbnN0IHQ9e3JlbGV2YW5jZTowLGVtaXR0ZXI6bmV3IGcuX19lbWl0dGVyKGcpLHZhbHVlOlUoZSksaWxsZWdhbDohMSx0b3A6dX07cmV0dXJuIHQuZW1pdHRlci5hZGRUZXh0KGUpLHR9KShlKSxyPXQuZmlsdGVyKE4pLmZpbHRlcihSKS5tYXAoKHQ9PmYodCxlLCExKSkpO3IudW5zaGlmdChzKTtjb25zdCBhPXIuc29ydCgoKGUsdCk9PntpZihlLnJlbGV2YW5jZSE9PXQucmVsZXZhbmNlKXJldHVybiB0LnJlbGV2YW5jZS1lLnJlbGV2YW5jZTtpZihlLmxhbmd1YWdlJiZ0Lmxhbmd1YWdlKXtpZihOKGUubGFuZ3VhZ2UpLnN1cGVyc2V0T2Y9PT10Lmxhbmd1YWdlKXJldHVybiAxO2lmKE4odC5sYW5ndWFnZSkuc3VwZXJzZXRPZj09PWUubGFuZ3VhZ2UpcmV0dXJuLTF9CiAgICAgICAgICAgICAgICByZXR1cm4gMH0pKSxbaSxvXT1hLGw9aTtyZXR1cm4gbC5zZWNvbmRfYmVzdD1vLGx9CiAgICAgICAgICAgIGNvbnN0IG09eyJiZWZvcmU6aGlnaGxpZ2h0QmxvY2siOih7YmxvY2s6ZX0pPT57Zy51c2VCUiYmKGUuaW5uZXJIVE1MPWUuaW5uZXJIVE1MLnJlcGxhY2UoL1xuL2csIiIpLnJlcGxhY2UoLzxiclsgL10qPi9nLCJcbiIpKX0sImFmdGVyOmhpZ2hsaWdodEJsb2NrIjooe3Jlc3VsdDplfSk9PntnLnVzZUJSJiYoZS52YWx1ZT1lLnZhbHVlLnJlcGxhY2UoL1xuL2csIjxicj4iKSl9fSxiPS9eKDxbXj5dKz58XHQpKy9nbSx4PXsiYWZ0ZXI6aGlnaGxpZ2h0QmxvY2siOih7cmVzdWx0OmV9KT0+e2cudGFiUmVwbGFjZSYmKGUudmFsdWU9ZS52YWx1ZS5yZXBsYWNlKGIsKGU9PmUucmVwbGFjZSgvXHQvZyxnLnRhYlJlcGxhY2UpKSkpfX07ZnVuY3Rpb24gRShlKXtsZXQgdD1udWxsO2NvbnN0IG49KGU9PntsZXQgdD1lLmNsYXNzTmFtZSsiICI7dCs9ZS5wYXJlbnROb2RlP2UucGFyZW50Tm9kZS5jbGFzc05hbWU6IiI7Y29uc3Qgbj1nLmxhbmd1YWdlRGV0ZWN0UmUuZXhlYyh0KTtpZihuKXtjb25zdCB0PU4oblsxXSk7cmV0dXJuIHR8fChIKGwucmVwbGFjZSgie30iLG5bMV0pKSxIKCJGYWxsaW5nIGJhY2sgdG8gbm8taGlnaGxpZ2h0IG1vZGUgZm9yIHRoaXMgYmxvY2suIixlKSksdD9uWzFdOiJuby1oaWdobGlnaHQifQogICAgICAgICAgICAgICAgcmV0dXJuIHQuc3BsaXQoL1xzKy8pLmZpbmQoKGU9PmQoZSl8fE4oZSkpKX0pKGUpO2lmKGQobikpcmV0dXJuO18oImJlZm9yZTpoaWdobGlnaHRCbG9jayIse2Jsb2NrOmUsbGFuZ3VhZ2U6bn0pLHQ9ZTtjb25zdCBzPXQudGV4dENvbnRlbnQsYT1uP2gobixzLCEwKTpwKHMpO18oImFmdGVyOmhpZ2hsaWdodEJsb2NrIix7YmxvY2s6ZSxyZXN1bHQ6YSx0ZXh0OnN9KSxlLmlubmVySFRNTD1hLnZhbHVlLCgoZSx0LG4pPT57Y29uc3Qgcz10P3JbdF06bjtlLmNsYXNzTGlzdC5hZGQoImhsanMiKSxzJiZlLmNsYXNzTGlzdC5hZGQocyl9KShlLG4sYS5sYW5ndWFnZSksZS5yZXN1bHQ9e2xhbmd1YWdlOmEubGFuZ3VhZ2UscmU6YS5yZWxldmFuY2UscmVsYXZhbmNlOmEucmVsZXZhbmNlfSxhLnNlY29uZF9iZXN0JiYoZS5zZWNvbmRfYmVzdD17bGFuZ3VhZ2U6YS5zZWNvbmRfYmVzdC5sYW5ndWFnZSxyZTphLnNlY29uZF9iZXN0LnJlbGV2YW5jZSxyZWxhdmFuY2U6YS5zZWNvbmRfYmVzdC5yZWxldmFuY2V9KX0KICAgICAgICAgICAgY29uc3Qgdj0oKT0+e3YuY2FsbGVkfHwodi5jYWxsZWQ9ITAsZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgicHJlIGNvZGUiKS5mb3JFYWNoKEUpKX07ZnVuY3Rpb24gTihlKXtyZXR1cm4gZT0oZXx8IiIpLnRvTG93ZXJDYXNlKCksbltlXXx8bltyW2VdXX0KICAgICAgICAgICAgZnVuY3Rpb24gdyhlLHtsYW5ndWFnZU5hbWU6dH0peyJzdHJpbmciPT10eXBlb2YgZSYmKGU9W2VdKSxlLmZvckVhY2goKGU9PntyW2VdPXR9KSl9CiAgICAgICAgICAgIGZ1bmN0aW9uIFIoZSl7Y29uc3QgdD1OKGUpO3JldHVybiB0JiYhdC5kaXNhYmxlQXV0b2RldGVjdH0KICAgICAgICAgICAgZnVuY3Rpb24gXyhlLHQpe2NvbnN0IG49ZTthLmZvckVhY2goKGU9PntlW25dJiZlW25dKHQpfSkpfQogICAgICAgICAgICBPYmplY3QuYXNzaWduKGUse2hpZ2hsaWdodDpoLGhpZ2hsaWdodEF1dG86cCxmaXhNYXJrdXA6ZT0+e3JldHVybiAkKCIxMC4yLjAiLCJmaXhNYXJrdXAgd2lsbCBiZSByZW1vdmVkIGVudGlyZWx5IGluIHYxMS4wIiksJCgiMTAuMi4wIiwiUGxlYXNlIHNlZSBodHRwczovL2dpdGh1Yi5jb20vaGlnaGxpZ2h0anMvaGlnaGxpZ2h0LmpzL2lzc3Vlcy8yNTM0IiksdD1lLGcudGFiUmVwbGFjZXx8Zy51c2VCUj90LnJlcGxhY2UobywoZT0+IlxuIj09PWU/Zy51c2VCUj8iPGJyPiI6ZTpnLnRhYlJlcGxhY2U/ZS5yZXBsYWNlKC9cdC9nLGcudGFiUmVwbGFjZSk6ZSkpOnQ7dmFyIHR9LGhpZ2hsaWdodEJsb2NrOkUsY29uZmlndXJlOmU9PntlLnVzZUJSJiYoJCgiMTAuMy4wIiwiJ3VzZUJSJyB3aWxsIGJlIHJlbW92ZWQgZW50aXJlbHkgaW4gdjExLjAiKSwkKCIxMC4zLjAiLCJQbGVhc2Ugc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9oaWdobGlnaHRqcy9oaWdobGlnaHQuanMvaXNzdWVzLzI1NTkiKSksZz16KGcsZSl9LGluaXRIaWdobGlnaHRpbmc6dixpbml0SGlnaGxpZ2h0aW5nT25Mb2FkOigpPT57d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLHYsITEpfSxyZWdpc3Rlckxhbmd1YWdlOih0LHMpPT57bGV0IHI9bnVsbDt0cnl7cj1zKGUpfWNhdGNoKGUpe2lmKEMoIkxhbmd1YWdlIGRlZmluaXRpb24gZm9yICd7fScgY291bGQgbm90IGJlIHJlZ2lzdGVyZWQuIi5yZXBsYWNlKCJ7fSIsdCkpLCFpKXRocm93IGU7QyhlKSxyPXV9CiAgICAgICAgICAgICAgICAgICAgci5uYW1lfHwoci5uYW1lPXQpLG5bdF09cixyLnJhd0RlZmluaXRpb249cy5iaW5kKG51bGwsZSksci5hbGlhc2VzJiZ3KHIuYWxpYXNlcyx7bGFuZ3VhZ2VOYW1lOnR9KX0sbGlzdExhbmd1YWdlczooKT0+T2JqZWN0LmtleXMobiksZ2V0TGFuZ3VhZ2U6TixyZWdpc3RlckFsaWFzZXM6dyxyZXF1aXJlTGFuZ3VhZ2U6ZT0+eyQoIjEwLjQuMCIsInJlcXVpcmVMYW5ndWFnZSB3aWxsIGJlIHJlbW92ZWQgZW50aXJlbHkgaW4gdjExLiIpLCQoIjEwLjQuMCIsIlBsZWFzZSBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2hpZ2hsaWdodGpzL2hpZ2hsaWdodC5qcy9wdWxsLzI4NDQiKTtjb25zdCB0PU4oZSk7aWYodClyZXR1cm4gdDt0aHJvdyBFcnJvcigiVGhlICd7fScgbGFuZ3VhZ2UgaXMgcmVxdWlyZWQsIGJ1dCBub3QgbG9hZGVkLiIucmVwbGFjZSgie30iLGUpKX0sYXV0b0RldGVjdGlvbjpSLGluaGVyaXQ6eixhZGRQbHVnaW46ZT0+e2EucHVzaChlKX0sdnVlUGx1Z2luOmooZSkuVnVlUGx1Z2lufSksZS5kZWJ1Z01vZGU9KCk9PntpPSExfSxlLnNhZmVNb2RlPSgpPT57aT0hMH0sZS52ZXJzaW9uU3RyaW5nPSIxMC41LjAiO2Zvcihjb25zdCBlIGluIHkpIm9iamVjdCI9PXR5cGVvZiB5W2VdJiZ0KHlbZV0pO3JldHVybiBPYmplY3QuYXNzaWduKGUseSksZS5hZGRQbHVnaW4obSksZS5hZGRQbHVnaW4oUyksZS5hZGRQbHVnaW4oeCksZX0pKHt9KX0oKTsib2JqZWN0Ij09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT10eXBlb2YgbW9kdWxlJiYobW9kdWxlLmV4cG9ydHM9aGxqcyk7aGxqcy5yZWdpc3Rlckxhbmd1YWdlKCJqc29uIiwoKCk9PnsidXNlIHN0cmljdCI7cmV0dXJuIG49Pntjb25zdCBlPXtsaXRlcmFsOiJ0cnVlIGZhbHNlIG51bGwifSxpPVtuLkNfTElORV9DT01NRU5UX01PREUsbi5DX0JMT0NLX0NPTU1FTlRfTU9ERV0sYT1bbi5RVU9URV9TVFJJTkdfTU9ERSxuLkNfTlVNQkVSX01PREVdLGw9e2VuZDoiLCIsZW5kc1dpdGhQYXJlbnQ6ITAsZXhjbHVkZUVuZDohMCxjb250YWluczphLGtleXdvcmRzOmV9LHQ9e2JlZ2luOi9cey8sZW5kOi9cfS8sY29udGFpbnM6W3tjbGFzc05hbWU6ImF0dHIiLGJlZ2luOi8iLyxlbmQ6LyIvLGNvbnRhaW5zOltuLkJBQ0tTTEFTSF9FU0NBUEVdLGlsbGVnYWw6IlxcbiJ9LG4uaW5oZXJpdChsLHtiZWdpbjovOi99KV0uY29uY2F0KGkpLGlsbGVnYWw6IlxcUyJ9LHM9e2JlZ2luOiJcXFsiLGVuZDoiXFxdIixjb250YWluczpbbi5pbmhlcml0KGwpXSxpbGxlZ2FsOiJcXFMifTtyZXR1cm4gYS5wdXNoKHQscyksaS5mb3JFYWNoKChuPT57YS5wdXNoKG4pfSkpLHtuYW1lOiJKU09OIixjb250YWluczphLGtleXdvcmRzOmUsaWxsZWdhbDoiXFxTIn19fSkoKSk7Cjwvc2NyaXB0Pgo8c2NyaXB0PgogICAgaGxqcy5pbml0SGlnaGxpZ2h0aW5nT25Mb2FkKCkKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZSBjb2RlJykuZm9yRWFjaCgoYmxvY2spID0+IHsKICAgICAgICBobGpzLmhpZ2hsaWdodEJsb2NrKGJsb2NrKTsKICAgIH0pOwo8L3NjcmlwdD4KPC9odG1sPg==")
	Html     = string(_Html)
)

type (
	Page struct {
		XMLName xml.Name    `xml:"root" json:"-"`
		Code    int         `json:"code" xml:"code"`
		Message string      `json:"message" xml:"message"`
		Page    int         `json:"page" xml:"page"`
		Total   int64       `json:"total" xml:"total"`
		Limit   int         `json:"limit" xml:"limit"`
		Data    interface{} `json:"data" xml:"data"`
	}
	Data struct {
		XMLName xml.Name    `xml:"root" json:"-"`
		Code    int         `xml:"code" json:"code"`
		Message string      `xml:"message" json:"message"`
		Data    interface{} `xml:"data" json:"data"`
	}
	Response struct {
		ctx      iris.Context
		err      error
		hasError bool
	}
)

func (r *Response) Context(ctx iris.Context) *Response {
	r.ctx = ctx
	return r
}

// Page 设置页面数据
func (r *Response) SetPage(data Page) *Response {
	buf := new(bytes.Buffer)
	tpl, err := template.New("html").Parse(Html)
	if err != nil {
		r.hasError = true
		r.err = err
		buf.Write([]byte(err.Error()))
	}
	var Json string
	jsonByte, err := json.Marshal(data)
	if err != nil {
		Json = err.Error()
	} else {
		Json = string(jsonByte)
	}
	err = tpl.Execute(buf, map[string]interface{}{
		"Code":    data.Code,
		"Message": data.Message,
		"Json":    Json,
	})
	if err != nil {
		r.hasError = true
		r.err = err
		buf.Write([]byte(err.Error()))
	}
	r.ctx.Negotiation().JSON(data).XML(data).HTML(buf.String()).EncodingGzip()
	return r
}

// SetData 设置输出数据
func (r *Response) SetData(data Data) *Response {
	buf := new(bytes.Buffer)
	tpl, err := template.New("html").Parse(Html)
	if err != nil {
		r.hasError = true
		r.err = err
		buf.Write([]byte(err.Error()))
	}
	var Json string
	jsonByte, err := json.Marshal(data)
	if err != nil {
		Json = err.Error()
	} else {
		Json = string(jsonByte)
	}
	err = tpl.Execute(buf, map[string]interface{}{
		"Code":    data.Code,
		"Message": data.Message,
		"Json":    Json,
	})
	if err != nil {
		r.hasError = true
		r.err = err
		buf.Write([]byte(err.Error()))
	}
	r.ctx.Negotiation().JSON(data).XML(data).HTML(buf.String()).EncodingGzip()
	return r
}

// Data 创建输出数据
func (r *Response) Data(code int, message string, data interface{}) *Response {
	d := &Data{
		Code:    code,
		Message: message,
		Data:    data,
	}
	buf := new(bytes.Buffer)
	tpl, err := template.New("html").Parse(Html)
	if err != nil {
		buf.Write([]byte(err.Error()))
	}
	var Json string
	jsonByte, err := json.MarshalIndent(d, "", "\t")
	if err != nil {
		Json = err.Error()
	} else {
		Json = string(jsonByte)
	}
	err = tpl.Execute(buf, map[string]interface{}{
		"Code":    d.Code,
		"Message": d.Message,
		"Json":    Json,
	})
	if err != nil {
		buf.Write([]byte(err.Error()))
	}
	r.ctx.Negotiation().JSON(d).XML(d).HTML(buf.String()).EncodingGzip()
	return r
}

// Send 输出数据
func (r *Response) Send() (int, error) {
	i, e := r.ctx.Negotiate(nil)
	if e != nil {
		r.ctx.Application().Logger().Error(e)
	}
	return i, e
}
